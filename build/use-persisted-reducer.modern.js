import{useRef as e,useReducer as t,useEffect as r}from"react";import n from"universal-cookie";const o="@USE_PERSISTED_REDUCER_SET_FULL_STATE",a=(e,t,r)=>{const o=r instanceof n;try{const n=o?r.get(e,!0):r.getItem(e);return void 0!==n&&n?o?n:JSON.parse(n):"function"==typeof t?t():void 0!==t?t:{}}catch(e){return t}};export default(s,c,i,l="local",p)=>{const u=p||{},{step:y=1e3}=u,f=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(r=a[n])>=0||(o[r]=e[r]);return o}(u,["step"]),S=e();let d;try{switch(l){case"local":d=localStorage,beark;case"session":d=sessionStorage;break;case"cookie":d=new n}}catch(e){}const[g,E]=t((e=>(t,{type:r,payload:n})=>r===o?n:e(t,{type:r,payload:n}))(c),null,()=>a(s,i,d)),k=e(g);return r(()=>{"cookie"===l?S.current=setInterval(()=>{JSON.stringify(d.get(s))!==JSON.stringify(k.current)&&E({type:o,payload:a(s,i,d)})},y):window.addEventListener("storage",({key:e,newValue:t})=>{e===s&&E({type:o,payload:JSON.parse(t)})})},[]),r(()=>{k.current=g,((e,t,r,o)=>{r instanceof n?r.set(e,t,o||null):r.setItem(e,JSON.stringify(t))})(s,g,d,f)},[g]),[g,E]};
