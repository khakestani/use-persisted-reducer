import{useRef as e,useReducer as t,useEffect as o}from"react";import n from"universal-cookie";const r="@USE_PERSISTED_REDUCER_SET_FULL_STATE",s=(e,t,o)=>{console.log("init",t);const r=o instanceof n;try{const n=r?o.get(e,!0):o.getItem(e);return console.log("storageData",n),void 0!==n&&n?r?n:JSON.parse(n):"function"==typeof t?t():void 0!==t?t:{}}catch(e){return console.log("Error --\x3e Getting storage data : ",e),t}};export default(a,c,l,i="local",u)=>{const g=u||{},{step:d=1e3}=g,p=function(e,t){if(null==e)return{};var o,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)t.indexOf(o=s[n])>=0||(r[o]=e[o]);return r}(g,["step"]);console.log("usePersistedReducer -> cookieOption",p);const y=e();let f;try{switch(i){case"local":f=localStorage,beark;case"session":f=sessionStorage;break;case"cookie":f=new n}}catch(e){}const[S,E]=t((e=>(t,{type:o,payload:n})=>o===r?n:e(t,{type:o,payload:n}))(c),null,()=>{const e=s(a,l,f);return console.log("usePersistedReducer -> d",e),e}),k=e(S);return o(()=>{"cookie"===i?y.current=setInterval(()=>{JSON.stringify(f.get(a))!==JSON.stringify(k.current)&&E({type:r,payload:s(a,l,f)})},d):window.addEventListener("storage",({key:e,newValue:t})=>{e===a&&E({type:r,payload:JSON.parse(t)})})},[]),o(()=>{k.current=S,((e,t,o,r)=>{console.log("value",t),o instanceof n?o.set(e,t,r||null):o.setItem(e,JSON.stringify(t))})(a,S,f,p)},[S]),[S,E]};
