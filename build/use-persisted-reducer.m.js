import{useRef as e,useReducer as t,useEffect as o}from"react";import n from"universal-cookie";var r="@USE_PERSISTED_REDUCER_SET_FULL_STATE",a=function(e,t,o){console.log("init",t);var r=o instanceof n;try{var a=r?o.get(e,!0):o.getItem(e);return console.log("storageData",a),void 0!==a&&a?r?a:JSON.parse(a):"function"==typeof t?t():void 0!==t?t:{}}catch(e){return console.log("Error --\x3e Getting storage data : ",e),t}};export default function(i,c,s,l,u){void 0===l&&(l="local");var f=u||{},d=f.step,g=void 0===d?1e3:d,p=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)t.indexOf(o=a[n])>=0||(r[o]=e[o]);return r}(f,["step"]);console.log("usePersistedReducer -> cookieOption",p);var v,y=e();try{switch(l){case"local":v=localStorage,beark;case"session":v=sessionStorage;break;case"cookie":v=new n}}catch(e){}var S=t(function(e){return function(t,o){var n=o.type,a=o.payload;return n===r?a:e(t,{type:n,payload:a})}}(c),null,function(){var e=a(i,s,v);return console.log("usePersistedReducer -> d",e),e}),E=S[0],k=S[1],O=e(E);return o(function(){"cookie"===l?y.current=setInterval(function(){JSON.stringify(v.get(i))!==JSON.stringify(O.current)&&k({type:r,payload:a(i,s,v)})},g):window.addEventListener("storage",function(e){e.key===i&&k({type:r,payload:JSON.parse(e.newValue)})})},[]),o(function(){O.current=E,function(e,t,o,r){console.log("value",t),o instanceof n?o.set(e,t,r||null):o.setItem(e,JSON.stringify(t))}(i,E,v,p)},[E]),[E,k]}
